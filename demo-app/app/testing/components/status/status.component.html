<div class="status-container">
    <mat-card [style.border-bottom]="getBorder()" class="a">
        <h1>{{ data?.name.toUpperCase() }} STATUS</h1>
        <mat-card-subtitle *ngIf="(data?.metrics.status === 'GREEN'); else failureSubTitle">
            Passing Since: {{ data?.metrics.greenSinceDate | date }}
        </mat-card-subtitle>
    </mat-card>

    <mat-card class="c" *ngIf="(data?.metrics.status === 'GREEN'); else lastFailure">

        <h2>LAST SUCCESSFUL RUN</h2>
        <mat-card-content>
            <p>
                <span>Author:</span> {{ data?.metrics.lastSuccess.author }}
            </p>
            <p>
                <span>Date:</span> {{ data?.metrics.lastSuccess.time | date }}
            </p>
            <p>
                <span>Branch Name:</span> {{ data?.metrics.lastSuccess.branchName }}</p>
            <p>
                <span>Commit Message:</span> {{ data?.metrics.lastSuccess.commitMessage }}</p>
            <a [attr.href]="data?.metrics.lastSuccess.concourseUrl" target="_blank">
                <img class="icon" src="../../../assets/concourse.png" alt="concourse logo" />
            </a>
            <a [attr.href]="data?.repoUrl + '/commits/' + data.metrics.lastSuccess.commitHash" target="_blank">
                <img class="icon" src="../../../assets/bitbucket.png" alt="bit bucket logo" />
            </a>
        </mat-card-content>
    </mat-card>

    <mat-card class="d">
        <h1>RECENT ACTIVITY</h1>
    </mat-card>

    <mat-card class="e">
        <h2 class="e1">MASTER BRANCH</h2>
        <mat-card-content class="e2">
            <img class="avatar" src="{{ masterBranch?.latestCommit.author.avatarUrl }}" alt="avatar url" />
        </mat-card-content>
        <mat-card-content class="e3">
            <p>
                <span>Author:</span> {{ masterBranch?.latestCommit.author.displayName }}
            </p>
            <p>
                <span>Email:</span> {{ masterBranch?.latestCommit.author.emailAddress }}
            </p>
            <p>
                <span>Commit Message:</span> {{ masterBranch?.latestCommit.message }}
            </p>
        </mat-card-content>
    </mat-card>

    <mat-card class="f">
        <h2 class="f1">DEVELOP BRANCH</h2>
        <mat-card-content class="f2">
            <img class="avatar" src="{{ developBranch?.latestCommit.author.avatarUrl }}" alt="avatar url" />
        </mat-card-content>
        <mat-card-content class="f3">
            <p>
                <span>Author:</span> {{ developBranch?.latestCommit.author.displayName }}</p>
            <p>
                <span>Email:</span> {{ developBranch?.latestCommit.author.emailAddress }}</p>
            <p>
                <span>Commit Message:</span> {{ developBranch?.latestCommit.message }}</p>
        </mat-card-content>
    </mat-card>

    <mat-card class="g">
        <h1>BUILDS</h1>
    </mat-card>

    <mat-card class="h">
        <h2>MASTER BUILDS</h2>
        <mat-card-content>
            <mat-expansion-panel *ngFor="let build of data.branches.values[1].builds">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <p>
                            <span>{{ build?.author }}</span>
                        </p>
                    </mat-panel-title>
                    <mat-panel-description>
                        <p>
                            <span>{{ build?.status }}</span>
                        </p>
                    </mat-panel-description>
                </mat-expansion-panel-header>
                <div>
                    <p>
                        <span>Date:</span> {{ build?.time | date }}</p>
                    <p>
                        <span>Duration:</span> {{ build?.duration }} Seconds</p>
                    <p>
                        <span>Pipeline:</span> {{ build?.pipeline }}</p>
                    <p>
                        <span>Commit Message:</span> {{ build?.commitMessage }}</p>
                </div>
            </mat-expansion-panel>
        </mat-card-content>
    </mat-card>

    <mat-card class="i">
        <h2>DEVELOP BRANCH</h2>
        <mat-card-content>
            <mat-expansion-panel *ngFor="let build of data.branches.values[0].builds">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <p>
                            <span>{{ build?.author }}</span>
                        </p>
                    </mat-panel-title>
                    <mat-panel-description>
                        <p>
                            <span>{{ build?.status }}</span>
                        </p>
                    </mat-panel-description>
                </mat-expansion-panel-header>
                <div>
                    <p>
                        <span>Date:</span> {{ build?.time | date }}</p>
                    <p>
                        <span>Duration:</span> {{ build?.duration }} Seconds</p>
                    <p>
                        <span>Pipeline:</span> {{ build?.pipeline }}</p>
                    <p>
                        <span>Commit Message:</span> {{ build?.commitMessage }}</p>
                </div>
            </mat-expansion-panel>
        </mat-card-content>
    </mat-card>
</div>

<ng-template #lastFailure>
    <mat-card class="c">
        <h2>LAST FAILED RUN</h2>
        <mat-card-content>
            <p>
                <span>Author:</span> {{ data?.metrics.lastFailure.author }}
            </p>
            <p>
                <span>Date:</span> {{ data?.metrics.lastFailure.time | date }}
            </p>
            <p>
                <span>Branch Name:</span> {{ data?.metrics.lastFailure.branchName }}</p>
            <p>
                <span>Commit Message:</span> {{ data?.metrics.lastFailure.commitMessage }}</p>
            <a [attr.href]="data?.metrics.lastFailure.concourseUrl" target="_blank">
                <img class="icon" src="../../../assets/concourse.png" alt="concourse logo" />
            </a>
            <a [attr.href]="data?.repoUrl + '/commits/' + data.metrics.lastFailure.commitHash" target="_blank">
                <img class="icon" src="../../../assets/bitbucket.png" alt="bit bucket logo" />
            </a>
        </mat-card-content>
    </mat-card>
</ng-template>

<ng-template #failureSubTitle>
    <mat-card-subtitle id="failing-subtitle">
        FAILING
    </mat-card-subtitle>
</ng-template>